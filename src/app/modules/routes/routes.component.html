<div class="px-5 pt-2 pb-10">
  <mat-card class="px-5 mb-5 mt-5">
    <div class="grid grid-cols-12 items-center">
      <div class="col-span-1">
        <p class="text-lg">
          # Rutas:
          <span class="text-blue_3 font-black">{{ routes.length }}</span>
        </p>
      </div>

      <mat-form-field class="mr-5 translate-y-2 col-span-9">
        <mat-label>Buscar Ruta</mat-label>
        <input
          matInput
          placeholder="Nombre de la ruta o lugar"
          #input
          (keydown)="filterClients($event)"
        />
        <button
          mat-icon-button
          style="position: absolute; right: 0; top: 5px"
          (click)="filterClients(input.value)"
        >
          <mat-icon matSuffix class="cursor-pointer">search</mat-icon>
        </button>
        <button
          mat-icon-button
          style="position: absolute; right: 50px; top: 5px"
          (click)="clearFilter(input)"
        >
          <mat-icon matSuffix class="cursor-pointer">close</mat-icon>
        </button>
      </mat-form-field>
      <div class="text-right">
        <button
          class="mt-5 w-1/8 m-4"
          mat-raised-button
          style="
            background-color: #6ddbda;
            color: white;
            padding: 0 50px 0 50px;
          "
          (click)="showDialogRoute(null, 1)"
          *ngIf="roleActual == 'Administrador'"
        >
          Agregar
        </button>
      </div>
    </div>
  </mat-card>

  <mat-accordion>
    <mat-expansion-panel *ngFor="let route of routes">
      <mat-expansion-panel-header>
        <div class="w-full h-full grid grid-cols-12 items-center">
          <div class="col-span-2" *ngIf="roleActual == 'Administrador'">
            <button mat-icon-button (click)="showDialogRoute(route, 1)">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button (click)="showDialogRoute(route, 2)">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
          <div class="col-span-2 rounded">
            <p>
              Ruta: <span class="text-blue_3">{{ route.name }}</span>
            </p>
          </div>

          <div class="col-span-2 rounded">
            <p>
              Lugar de Reparto:
              <span class="text-blue_2">{{ route.location }}</span>
            </p>
          </div>

          <div class="col-span-4 rounded">
            <p>
              Días de Reparto:
              <span class="text-green_1">{{ route.weekdays }}</span>
            </p>
          </div>

          <div class="col-span-2" [ngSwitch]="route.status">
            <p>
              Estado:
              <span *ngSwitchCase="'PREORDER'" class="text-blue_3"
                >En preventa</span
              >
              <span *ngSwitchCase="'OPENED'" class="text-blue_3"
                >En Distribución</span
              >
              <span *ngSwitchCase="'CLOSE_REQUEST'" class="text-blue_3"
                >Solicitud de cierre</span
              >
              <span *ngSwitchCase="'CLOSED'" class="text-blue_3">Cerrada</span>
              <span *ngSwitchCase="'WHITOUT'" class="text-blue_3"
                >Sin distribuciones</span
              >
            </p>
          </div>
        </div>
      </mat-expansion-panel-header>

      <div class="grid grid-cols-3">
        <div class="col-start-1 col-span-2">
          <table
            aria-describedby="weekdays"
            mat-table
            [dataSource]="[route]"
            class="mat-elevation-z8"
          >
            <ng-container
              *ngFor="let weekday of weekdays"
              matColumnDef="{{ weekday }}"
            >
              <th mat-header-cell *matHeaderCellDef>{{ weekday }}</th>
              <td mat-cell *matCellDef="let element">
                <div
                  class="color-div"
                  [style.background-color]="
                    route.weekdays.includes(weekday) ? '#6fdb90' : 'white'
                  "
                ></div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="weekdays"></tr>
            <tr mat-row *matRowDef="let row; columns: weekdays"></tr>
          </table>
        </div>

        <div
          class="col-start-3 rounded centered-container"
          [ngSwitch]="route.status"
        >
          <p>
            Estado:
            <span *ngSwitchCase="'PREORDER'" class="text-blue_3"
              >En preventa</span
            >
            <span *ngSwitchCase="'OPENED'" class="text-blue_3"
              >En Distribución</span
            >
            <span *ngSwitchCase="'CLOSE_REQUEST'" class="text-blue_3"
              >Solicitud de cierre</span
            >
            <span *ngSwitchCase="'CLOSED'" class="" [formGroup]="formDate">
              <span class="text-blue_3">Cerrada</span> <br /><br />

              <mat-form-field class="example-form-field">
                <mat-label>Fecha de distribución</mat-label>
                <input
                  matInput
                  [matDatepicker]="datepicker"
                  formControlName="date"
                  [min]="minDate"
                />
                <mat-hint>DD/MM/YYYY</mat-hint>
                <mat-datepicker-toggle
                  matIconSuffix
                  [for]="datepicker"
                ></mat-datepicker-toggle>
                <mat-datepicker #datepicker>
                  <mat-datepicker-actions>
                    <button mat-button matDatepickerCancel>Cancel</button>
                    <button
                      mat-raised-button
                      color="primary"
                      matDatepickerApply
                    >
                      Apply
                    </button>
                  </mat-datepicker-actions>
                </mat-datepicker>
              </mat-form-field>
            </span>
            <span *ngSwitchCase="'WHITOUT'" class="" [formGroup]="formDate">
              <span class="text-blue_3">Sin distribuciones</span> <br /><br />

              <mat-form-field class="example-form-field">
                <mat-label>Fecha de distribución</mat-label>
                <input
                  matInput
                  [matDatepicker]="datepicker"
                  formControlName="date"
                  [min]="minDate"
                />
                <mat-hint>DD/MM/YYYY</mat-hint>
                <mat-datepicker-toggle
                  matIconSuffix
                  [for]="datepicker"
                ></mat-datepicker-toggle>
                <mat-datepicker #datepicker>
                  <mat-datepicker-actions>
                    <button mat-button matDatepickerCancel>Cancel</button>
                    <button
                      mat-raised-button
                      color="primary"
                      matDatepickerApply
                    >
                      Apply
                    </button>
                  </mat-datepicker-actions>
                </mat-datepicker>
              </mat-form-field>
            </span>
          </p>
          <button
            mat-raised-button
            type="button"
            class="w-1/2 mt-5 bg-blue_3 text-white button-status"
            [style]="
              formDate.invalid
                ? 'background-color: #E3E3E3; color: white'
                : 'background-color: #6fdb90; color: white'
            "
            *ngIf="route.status ? route.status.toString() === 'CLOSED' : false"
            (click)="managementRoute(route, true)"
            [disabled]="formDate.invalid"
          >
            Iniciar Distribución
          </button>
          <button
            mat-raised-button
            type="button"
            class="w-1/2 mt-5 bg-blue_3 text-white button-status"
            [style]="
              route.status?.toString() === 'WHITOUT'
                ? formDate.invalid
                  ? 'background-color: #E3E3E3; color: white'
                  : 'background-color: #404452; color: white'
                : 'background-color: #404452; color: white'
            "
            (click)="
              managementRoute(route, route.status?.toString() !== 'CLOSED')
            "
            [disabled]="
              route.status?.toString() === 'WHITOUT' ? formDate.invalid : false
            "
          >
            {{
              route.status
                ? route.status.toString() === "PREORDER"
                  ? "Ir a la preventa"
                  : route.status.toString() === "OPENED"
                  ? "Ir a la distribución"
                  : route.status.toString() === "CLOSE_REQUEST"
                  ? "Ir a la distribución"
                  : route.status.toString() === "CLOSED"
                  ? "Ver último reporte"
                  : "Iniciar Distribución"
                : "Iniciar Distribución"
            }}
          </button>
        </div>
      </div>
    </mat-expansion-panel>
  </mat-accordion>
</div>
